<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Asistente de Computaci칩n Cu치ntica</title>

  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #fafafa;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      margin-top: 1.5rem;
      font-size: 1.8rem;
    }

    #chatkit-root {
      height: 80vh;
      width: 100%;
      max-width: 900px;
      margin: 1rem auto;
      box-sizing: border-box;
    }
  </style>

  <!-- Carga el componente Web oficial de ChatKit -->
  <script src="https://cdn.platform.openai.com/deployments/chatkit/chatkit.js" async></script>
</head>

<body>
  <h1>游빏 Asistente de Computaci칩n Cu치ntica</h1>
  <div id="chatkit-root"></div>

  <script>
    window.addEventListener('load', async () => {
      const root = document.getElementById('chatkit-root');
      const chatkit = document.createElement('openai-chatkit');

      chatkit.setOptions({
        api: {
          // Obtiene el client_secret desde la funci칩n serverless
          async getClientSecret() {
            try {
              const response = await fetch('/.netlify/functions/create-session', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
              });
              const data = await response.json();

              if (!response.ok || !data.client_secret) {
                console.error("Error al crear sesi칩n:", data);
                throw new Error(data.error || "No se recibi칩 client_secret v치lido.");
              }

              return data.client_secret;
            } catch (err) {
              console.error("Fallo en getClientSecret:", err);
              throw err;
            }
          }
        },
        // Opciones visuales opcionales
        locale: 'es',
        theme: 'light',
        startScreen: { greeting: '游녦 춰Hola! Soy tu asistente de computaci칩n cu치ntica.' }
      });

      // Ajusta tama침o m칤nimo
      chatkit.classList.add('h-[600px]', 'w-full');
      root.appendChild(chatkit);
    });
  </script>
</body>
</html>